/* --- Global Variables --- */
:root {
    --rabbit-orange: #ff7e00;
    --rabbit-orange-dark: #e67200;
    --off-white: #f9f9f9; /* Slightly brighter */
    --light-gray: #e8e8e8;
    --medium-gray: #cccccc;
    --dark-gray: #333333;
    --device-gray: #d8d8d8; /* Slightly lighter device body */
    --error-red: #e74c3c; /* Brighter red */
    --success-green: #2ecc71; /* Brighter green */
    --glass-bg: rgba(50, 50, 50, 0.45); /* Darker glass for better contrast on video */
    --glass-border: rgba(255, 255, 255, 0.3);
    --glass-blur: 12px; /* More blur */
    --transition-speed: 0.4s; /* Consistent transition speed */
    --transition-timing: cubic-bezier(0.25, 0.8, 0.25, 1); /* Smoother ease-out */
}

/* --- Base Styles --- */
* { margin: 0; padding: 0; box-sizing: border-box; }
html { height: -webkit-fill-available; /* iOS viewport height fix */ }
body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); /* Subtle gradient background */
    color: var(--dark-gray);
    display: flex; justify-content: center; align-items: center;
    min-height: 100vh;
    /* iOS viewport height fix */
    min-height: -webkit-fill-available;
    padding: 20px;
    -webkit-tap-highlight-color: transparent;
    overflow: hidden; /* Prevent body scroll */
}

/* --- Device Container --- */
.device-container {
    width: 100%;
    max-width: 370px; /* Slightly wider */
    margin: 0 auto;
    perspective: 1000px; /* For 3D effects if needed */
}
.rabbit-device {
    background-color: var(--device-gray);
    border-radius: 30px; /* More rounded */
    padding: 18px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15), 0 5px 15px rgba(0, 0, 0, 0.1); /* Deeper shadow */
    display: flex; flex-direction: column; align-items: center; gap: 18px;
    border: 1px solid rgba(255, 255, 255, 0.5); /* Subtle inner border */
    position: relative; /* For absolute positioning of audio player if needed */
}

/* --- Main Display --- */
.main-display {
    background-color: var(--off-white);
    border-radius: 20px; /* More rounded inner display */
    width: 100%;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* --- Screens (General) --- */
.screen {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; flex-direction: column; align-items: center;
    padding: 25px; /* Default padding */
    opacity: 0; visibility: hidden;
    transition: opacity var(--transition-speed) var(--transition-timing),
                transform var(--transition-speed) var(--transition-timing),
                visibility var(--transition-speed) var(--transition-timing);
    transform: translateY(30px) scale(0.98); /* Start slightly scaled down and below */
    overflow-y: auto; /* Enable scrolling within screen */
    background-color: var(--off-white);
    scrollbar-width: thin; /* Firefox */
    scrollbar-color: var(--medium-gray) var(--light-gray); /* Firefox */
}
/* Scrollbar styling for Webkit browsers */
.screen::-webkit-scrollbar { width: 6px; }
.screen::-webkit-scrollbar-track { background: var(--light-gray); border-radius: 3px; }
.screen::-webkit-scrollbar-thumb { background-color: var(--medium-gray); border-radius: 3px; }

.active-screen {
    opacity: 1; visibility: visible;
    transform: translateY(0) scale(1); /* Animate to final position */
}
/* Specific transition for listening screen (fade only) */
.listening-screen { transform: none; transition: opacity 0.2s ease; }
.listening-screen.active-screen { transform: none; }

/* --- Common Screen Title --- */
.screen h2 {
    font-size: 22px; font-weight: 600; margin-bottom: 20px;
    text-align: center; width: 100%; color: var(--dark-gray);
    flex-shrink: 0;
    animation: fadeInDown 0.5s var(--transition-timing) backwards;
    animation-delay: 0.1s; /* Slight delay for title */
}

/* --- Back Button (Common) --- */
.back-button {
    padding: 10px 20px; /* Larger padding */
    background: linear-gradient(145deg, var(--medium-gray), var(--light-gray)); /* Subtle gradient */
    border: none; border-radius: 8px; /* More rounded */
    color: var(--dark-gray); cursor: pointer;
    transition: all 0.2s ease; /* Smooth transition for hover/active */
    font-size: 14px; display: inline-flex;
    align-items: center; gap: 8px;
    z-index: 10; /* Ensure above most content */
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    font-weight: 500;
}
.back-button:hover {
    background: linear-gradient(145deg, var(--light-gray), var(--medium-gray));
    box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    transform: translateY(-1px);
}
.back-button:active {
    transform: translateY(0px);
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}
/* Default positioning for back button (absolute for specific screens) */
.response-screen .back-button, .error-screen .back-button, .notes-screen .back-button,
.gallery-screen .back-button {
    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
    animation: fadeInUp 0.5s var(--transition-timing) backwards;
    animation-delay: 0.3s; /* Delay for back button */
}
 /* Standard margin for others */
.calendar-screen .back-button, .alarms-screen .back-button, .timer-screen .back-button,
.music-screen .back-button {
    margin-top: auto; /* Push to bottom */
    margin-bottom: 5px; /* Small space from bottom */
    animation: fadeInUp 0.5s var(--transition-timing) backwards;
    animation-delay: 0.3s;
}
/* Specific back button position for camera screens (absolute) */
.vision-screen .back-button, .look-at-this-screen .back-button {
    position: absolute; bottom: 20px; left: 50%;
    transform: translateX(-50%);
    animation: fadeInUp 0.5s var(--transition-timing) backwards;
    animation-delay: 0.6s; /* Delay more */
    /* Style adjustment for better visibility on video */
    background: var(--glass-bg);
    color: var(--off-white);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}
.vision-screen .back-button:hover, .look-at-this-screen .back-button:hover {
    background: rgba(80, 80, 80, 0.6);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    transform: translateX(-50%) translateY(-1px); /* Adjust transform */
}
.vision-screen .back-button:active, .look-at-this-screen .back-button:active {
    transform: translateX(-50%) translateY(0px); /* Adjust transform */
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
}

/* --- Specific Screen Styles --- */

/* Home Screen */
.home-screen {
    justify-content: center; text-align: center;
    position: relative; /* For status bar positioning */
    padding-top: 45px; /* Make space for status bar */
}
.status-bar {
    position: absolute;
    top: 10px;
    left: 15px;
    right: 15px;
    display: flex;
    justify-content: space-between; /* Distribute items */
    align-items: center;
    font-size: 11px; /* Smaller font */
    color: #555; /* Muted color */
    padding: 4px 8px;
    background-color: rgba(255, 255, 255, 0.6); /* Slight white background */
    border-radius: 10px;
    z-index: 5;
    animation: fadeIn 0.8s ease backwards;
    animation-delay: 0.4s;
}
.status-bar span { white-space: nowrap; } /* Prevent wrapping */
#home-battery { display: flex; align-items: center; gap: 4px; } /* Align battery icon and text */
#home-battery .fa-plug { font-size: 0.8em; color: var(--success-green); } /* Charging icon style */

.greeting { font-size: 28px; font-weight: 700; margin-bottom: 10px; animation: fadeInScale 0.6s var(--transition-timing) backwards; animation-delay: 0.1s; }
.instruction { font-size: 17px; color: #555; margin-bottom: 20px; animation: fadeInScale 0.6s var(--transition-timing) backwards; animation-delay: 0.2s; }
.permission-status { font-size: 13px; color: #666; margin-top: 15px; min-height: 1.2em; font-weight: 500; animation: fadeInScale 0.6s var(--transition-timing) backwards; animation-delay: 0.3s; }
.permission-status.error { color: var(--error-red); font-weight: 600; }

/* Listening Screen */
.listening-screen { justify-content: center; background-color: rgba(0,0,0,0.05); /* Slight overlay */ }
.listening-indicator { text-align: center; }
.listening-text { font-size: 20px; margin-bottom: 25px; animation: pulse 1.5s infinite alternate ease-in-out; }
.waveform { display: flex; justify-content: center; align-items: flex-end; gap: 6px; height: 50px; }
.waveform span {
    display: inline-block; width: 6px;
    background-color: var(--rabbit-orange);
    border-radius: 3px;
    animation: wave 1s infinite ease-in-out alternate;
}
/* Staggered animation delays for waveform */
.waveform span:nth-child(1) { height: 10px; animation-delay: 0s; }
.waveform span:nth-child(2) { height: 20px; animation-delay: 0.1s; }
.waveform span:nth-child(3) { height: 30px; animation-delay: 0.2s; }
.waveform span:nth-child(4) { height: 25px; animation-delay: 0.3s; }
.waveform span:nth-child(5) { height: 15px; animation-delay: 0.4s; } /* Added a 5th bar */

@keyframes wave {
    0% { height: 5px; opacity: 0.5; transform: scaleY(0.5); }
    100% { height: 45px; opacity: 1; transform: scaleY(1); }
}
@keyframes pulse {
    0% { opacity: 0.7; transform: scale(1); }
    100% { opacity: 1; transform: scale(1.03); }
}

/* Response Screen */
.response-screen { justify-content: flex-start; align-items: flex-start; padding-bottom: 75px; /* More space for back button */ }
.query-text { font-weight: 600; margin-bottom: 16px; align-self: flex-start; width: 100%; color: #555; border-bottom: 1px solid var(--light-gray); padding-bottom: 10px; word-wrap: break-word; animation: fadeInDown 0.4s var(--transition-timing) backwards; animation-delay: 0.1s; }
.response-text { width: 100%; font-size: 15px; line-height: 1.7; /* Increased line height */ word-wrap: break-word; padding-bottom: 30px; animation: fadeInUp 0.5s var(--transition-timing) backwards; animation-delay: 0.2s; }
.response-text p i { color: #777; } /* Slightly darker italic */
.response-text p.error-message { color: var(--error-red); font-weight: 600; background-color: rgba(231, 76, 60, 0.1); padding: 8px; border-radius: 4px; }
.response-text .loading-indicator { display: flex; justify-content: center; align-items: center; min-height: 50px; color: #888; font-style: italic; gap: 10px;}

/* Markdown Styles (Refined) */
.response-text p { margin-bottom: 1.2em; }
.response-text h1, .response-text h2, .response-text h3 { margin-top: 1.8em; margin-bottom: 1em; line-height: 1.4; color: var(--dark-gray); }
.response-text h1 { font-size: 1.7em; border-bottom: 2px solid var(--rabbit-orange); padding-bottom: 0.4em; }
.response-text h2 { font-size: 1.5em; }
.response-text h3 { font-size: 1.3em; }
.response-text ul, .response-text ol { margin-left: 30px; margin-bottom: 1.2em; padding-left: 0;} /* Reset padding */
.response-text li { margin-bottom: 0.6em; }
.response-text code { background-color: #eee; padding: 0.3em 0.5em; border-radius: 4px; font-family: 'Courier New', Courier, monospace; font-size: 0.95em; word-wrap: break-word; border: 1px solid #ddd; }
.response-text pre { background-color: #f0f0f0; padding: 18px; border-radius: 8px; overflow-x: auto; margin-bottom: 1.2em; border: 1px solid #ddd; box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); }
.response-text pre code { background-color: transparent; padding: 0; font-size: 0.95em; word-wrap: normal; border: none; }
.response-text blockquote { border-left: 5px solid var(--rabbit-orange); padding-left: 18px; margin: 1.5em 0; color: #555; font-style: italic; background-color: #fdf8f2; }
.response-text table { border-collapse: collapse; width: 100%; margin: 1.8em 0; border: 1px solid var(--medium-gray); box-shadow: 0 1px 3px rgba(0,0,0,0.05); border-radius: 4px; overflow: hidden; }
.response-text th, .response-text td { border: 1px solid var(--medium-gray); padding: 12px; text-align: left; }
.response-text th { background-color: var(--light-gray); font-weight: 600; }
.response-text tr:nth-child(even) { background-color: #f8f8f8; }
.response-text hr { border: none; border-top: 2px dashed var(--light-gray); margin: 2.5em 0; }
.response-text a { color: var(--rabbit-orange); text-decoration: none; font-weight: 500; transition: color 0.2s; }
.response-text a:hover { color: var(--rabbit-orange-dark); text-decoration: underline; }
.response-text img { max-width: 100%; height: auto; border-radius: 8px; margin: 1em 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

/* Alarms Screen */
.alarms-screen { justify-content: flex-start; }
.alarms-list { list-style: none; width: 100%; padding: 0; animation: fadeInUpList 0.6s var(--transition-timing) backwards; animation-delay: 0.1s; }
.alarms-list li {
    padding: 15px; border-bottom: 1px solid var(--light-gray);
    transition: background-color 0.2s;
    border-radius: 4px; margin-bottom: 5px;
}
.alarms-list li:hover { background-color: rgba(0,0,0,0.03); }

/* Timer Screen */
.timer-screen { justify-content: center; /* Center content vertically */ }
.timer-display { font-family: 'Press Start 2P', cursive; font-size: 36px; margin: 25px 0; color: var(--dark-gray); animation: pulse 1.5s infinite alternate ease-in-out; animation-play-state: paused; }
.timer-display.running { animation-play-state: running; }
.timer-controls { display: flex; gap: 15px; margin-bottom: 25px; animation: fadeInUp 0.5s var(--transition-timing) backwards; animation-delay: 0.2s; }
.timer-btn { padding: 10px 20px; background: linear-gradient(145deg, var(--medium-gray), var(--light-gray)); border: none; border-radius: 8px; color: var(--dark-gray); cursor: pointer; transition: all 0.2s ease; font-weight: 500; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
.timer-btn:hover { background: linear-gradient(145deg, var(--light-gray), var(--medium-gray)); box-shadow: 0 4px 8px rgba(0,0,0,0.08); transform: translateY(-1px); }
.timer-btn:active { transform: translateY(0px); box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }

/* Music Screen */
.music-screen { justify-content: center; /* Center content */ }
.album-art { width: 140px; height: 140px; background-color: var(--medium-gray); border-radius: 12px; margin-bottom: 20px; display: flex; justify-content: center; align-items: center; font-size: 50px; color: #fff; background-image: linear-gradient(45deg, #a0a0a0, #c0c0c0); box-shadow: 0 5px 15px rgba(0,0,0,0.1); animation: fadeInScale 0.6s var(--transition-timing) backwards; animation-delay: 0.1s; }
.album-art i { opacity: 0.8; } /* Make icon slightly transparent */
/* Remove ::before if using <i> */
/*.album-art::before { content: '\f001'; font-family: 'Font Awesome 6 Free'; font-weight: 900; }*/
.track-info { text-align: center; margin-bottom: 20px; animation: fadeInUp 0.5s var(--transition-timing) backwards; animation-delay: 0.2s; min-height: 45px; /* Prevent layout shift */ }
.track-title { font-weight: 600; font-size: 18px; margin-bottom: 5px; }
.artist-name { font-size: 15px; color: #666; }
.music-controls { display: flex; gap: 20px; margin-bottom: 25px; animation: fadeInUp 0.5s var(--transition-timing) backwards; animation-delay: 0.3s; }
.music-btn { width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(145deg, var(--medium-gray), var(--light-gray)); border: none; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: all 0.2s ease; font-size: 18px; color: var(--dark-gray); box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; overflow: hidden; /* For icon transition */ }
.music-btn:hover { background: linear-gradient(145deg, var(--light-gray), var(--medium-gray)); box-shadow: 0 4px 8px rgba(0,0,0,0.08); transform: scale(1.05); }
.music-btn:active { transform: scale(0.98); box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }

/* Play/Pause Icon Transition */
#play-pause .fa-play, #play-pause .fa-pause {
    position: absolute; /* Position icons on top of each other */
    transition: transform 0.2s ease, opacity 0.2s ease;
    transform: scale(1); opacity: 1;
}
#play-pause.playing .fa-play { transform: scale(0); opacity: 0; }
#play-pause.playing .fa-pause { transform: scale(1); opacity: 1; }
#play-pause:not(.playing) .fa-play { transform: scale(1); opacity: 1; }
#play-pause:not(.playing) .fa-pause { transform: scale(0); opacity: 0; }

/* --- Camera Screens Styling --- */
.vision-screen, .look-at-this-screen {
    justify-content: flex-start; /* Align items to top */
    padding: 0; /* Remove padding to allow full screen */
    overflow: hidden; /* Hide scrollbars for full screen camera */
}
/* Style title specifically for camera screens */
.vision-screen h2, .look-at-this-screen h2 {
    position: absolute; /* Position over the camera view */
    top: 15px; left: 50%; transform: translateX(-50%);
    z-index: 5; /* Ensure title is above video but below PTT */
    background: rgba(0, 0, 0, 0.4); /* Semi-transparent background */
    color: white;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 16px; /* Smaller title */
    margin-bottom: 0; /* Remove default margin */
    animation: fadeInDown 0.5s var(--transition-timing) backwards;
    animation-delay: 0.2s;
    pointer-events: none; /* Allow clicks through title */
}

/* Camera Container (Make it fill the screen) */
.camera-container {
    width: 100%; height: 100%; /* Fill the parent screen */
    flex-grow: 1; /* Ensure it takes space if screen is flex */
    background-color: #000; /* Black background */
    border-radius: 0; /* Remove border-radius, inherits from main-display */
    overflow: hidden;
    position: relative; /* Keep for absolute positioning inside */
    display: flex; justify-content: center; align-items: center;
    margin-bottom: 0; /* Remove margin */
    box-shadow: none; /* Remove shadow */
    animation: none; /* Remove entrance animation */
}
.camera-container i.placeholder-icon {
    font-size: 60px; color: #444; z-index: 0;
    transition: opacity 0.3s ease;
}
.camera-container.video-active i.placeholder-icon {
    opacity: 0;
}

/* Live Video Element (Make it fill the container) */
.live-video {
    display: block;
    position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover; /* Cover the container */
    z-index: 1; /* Below overlays */
    border-radius: 0; /* Match container */
    opacity: 0;
    transition: opacity 0.5s ease;
}
.live-video.active {
    opacity: 1;
}

/* Captured Image Preview (Make it fill the container) */
.captured-image-preview {
    position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover; z-index: 2; /* Above video */
    border-radius: 0; /* Match container */
    animation: fadeIn 0.3s ease;
}

/* Glassmorphism Overlay Style (Adjusted) */
.glass-overlay {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    background: var(--glass-bg);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--glass-border);
    border-radius: 16px; /* More rounded */
    padding: 10px 18px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    z-index: 3; /* Above video/preview, below back button potentially */
    color: var(--off-white); /* White text on darker glass */
    text-align: center;
    transition: transform 0.3s var(--transition-timing), opacity 0.3s ease;
}
.glass-overlay:hover {
    transform: translateX(-50%) scale(1.03);
}

/* Specific Overlays (Adjusted Positions) */
.vision-capture-overlay { bottom: 75px; animation: fadeInUp 0.5s var(--transition-timing) backwards; animation-delay: 0.4s; }
.look-capture-overlay { bottom: 75px; animation: fadeInUp 0.5s var(--transition-timing) backwards; animation-delay: 0.4s; }
.look-status-overlay { bottom: 130px; /* Position above capture button */ font-size: 14px; min-width: 220px; animation: fadeInUp 0.5s var(--transition-timing) backwards; animation-delay: 0.5s; padding: 8px 15px;}

.capture-btn, .look-capture-btn {
    padding: 10px 20px; background: var(--rabbit-orange); border: none;
    border-radius: 10px; color: white; cursor: pointer;
    transition: all 0.2s ease; font-size: 16px; font-weight: 600; /* Bolder */
    display: inline-flex; align-items: center; gap: 8px;
    box-shadow: 0 3px 6px rgba(255, 126, 0, 0.2);
}
.capture-btn:hover, .look-capture-btn:hover { background-color: var(--rabbit-orange-dark); box-shadow: 0 5px 10px rgba(255, 126, 0, 0.3); transform: translateY(-1px); }
.capture-btn:active, .look-capture-btn:active { transform: translateY(0px) scale(0.98); box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }
.look-capture-btn:disabled { background-color: var(--medium-gray); cursor: not-allowed; box-shadow: none; transform: none; opacity: 0.7; }
.look-capture-btn:disabled:hover { background-color: var(--medium-gray); transform: none; }

/* Error Screen */
.error-screen { justify-content: center; text-align: center; padding-bottom: 75px; }
.error-screen h2 { color: var(--error-red); animation: shake 0.5s ease; }
#error-message { margin-bottom: 25px; color: var(--error-red); font-weight: 500; font-size: 16px; background-color: rgba(231, 76, 60, 0.1); padding: 15px; border-radius: 8px; animation: fadeInUp 0.4s var(--transition-timing) backwards; animation-delay: 0.1s; }

/* Calendar Screen */
.calendar-screen { justify-content: center; }
.calendar-placeholder { width: 100%; max-width: 300px; height: 220px; background-color: #eee; border: 1px solid var(--light-gray); display: flex; flex-direction: column; justify-content: center; align-items: center; font-style: italic; color: #999; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); animation: fadeInScale 0.6s var(--transition-timing) backwards; animation-delay: 0.1s; }
.calendar-placeholder::before { content: '\f073'; font-family: 'Font Awesome 6 Free'; font-weight: 900; font-size: 40px; margin-bottom: 10px; color: var(--medium-gray); }

/* Notes Screen */
.notes-screen { justify-content: flex-start; padding-bottom: 95px; /* Extra space for save button + feedback + back */ }
.notes-textarea { width: 100%; flex-grow: 1; margin-bottom: 15px; padding: 15px; border: 1px solid var(--light-gray); border-radius: 8px; font-family: inherit; font-size: 15px; resize: vertical; box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); transition: border-color 0.2s, box-shadow 0.2s; animation: fadeInUp 0.5s var(--transition-timing) backwards; animation-delay: 0.1s; }
.notes-textarea:focus { border-color: var(--rabbit-orange); box-shadow: 0 0 0 3px rgba(255, 126, 0, 0.2), inset 0 1px 3px rgba(0,0,0,0.05); outline: none; }
.save-note-btn { padding: 10px 20px; background-color: var(--success-green); color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s; margin-bottom: 10px; /* Space before feedback */ font-weight: 600; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 3px 6px rgba(46, 204, 113, 0.2); animation: fadeInUp 0.5s var(--transition-timing) backwards; animation-delay: 0.2s; }
.save-note-btn:hover { background-color: #27ae60; box-shadow: 0 5px 10px rgba(46, 204, 113, 0.3); transform: translateY(-1px); }
.save-note-btn:active { transform: translateY(0px) scale(0.98); box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }
#notes-feedback { font-size: 13px; color: var(--success-green); min-height: 1.2em; text-align: center; margin-bottom: 15px; font-weight: 500; transition: opacity 0.3s; opacity: 0; }
#notes-feedback.visible { opacity: 1; }

/* Gallery Screen */
.gallery-screen { justify-content: flex-start; padding-bottom: 75px; }
.gallery-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 12px; width: 100%; margin-top: 15px; animation: fadeInUpList 0.6s var(--transition-timing) backwards; animation-delay: 0.1s; }
.gallery-item { position: relative; overflow: hidden; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: transform 0.2s ease; }
.gallery-item:hover { transform: scale(1.03); z-index: 5; }
.gallery-item img { display: block; width: 100%; height: 90px; object-fit: cover; border-radius: 8px; border: 1px solid var(--light-gray); }
.gallery-item .download-link { position: absolute; bottom: 6px; right: 6px; background-color: rgba(0,0,0,0.7); color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; text-decoration: none; font-size: 11px; transition: background-color 0.2s, transform 0.2s; opacity: 0; transform: scale(0.8); }
.gallery-item:hover .download-link { opacity: 1; transform: scale(1); }
.gallery-item .download-link:hover { background-color: var(--rabbit-orange); transform: scale(1.1); }
#gallery-empty-msg { font-style: italic; color: #999; text-align: center; width: 100%; margin-top: 30px; animation: fadeIn 0.5s ease; }

/* --- Controls (Bottom) --- */
.controls { display: flex; flex-direction: column; align-items: center; gap: 18px; width: 100%; padding-top: 5px; /* Add slight space above PTT */ }
.ptt-button {
    width: 65px; height: 65px; border-radius: 50%;
    background: linear-gradient(145deg, var(--rabbit-orange), #ff9a33); /* Gradient PTT */
    border: none; display: flex; justify-content: center; align-items: center;
    cursor: pointer; color: white; font-size: 28px;
    box-shadow: 0 5px 15px rgba(255, 126, 0, 0.35), inset 0 -2px 3px rgba(0,0,0,0.1); /* Enhanced shadow */
    transition: transform 0.15s ease, background 0.2s, box-shadow 0.2s;
    user-select: none; -webkit-user-select: none; touch-action: manipulation;
    position: relative; /* For pseudo-elements */
    overflow: hidden;
    z-index: 20; /* Ensure PTT is above overlays */
}
.ptt-button::before { /* Subtle shine effect */
    content: ''; position: absolute; top: 0; left: -75%; width: 50%; height: 100%;
    background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
    transform: skewX(-25deg); transition: left 0.5s ease;
}
.ptt-button:not(:disabled):hover::before { left: 125%; }

.ptt-button:active, .ptt-button.active {
    transform: scale(0.94);
    background: linear-gradient(145deg, var(--rabbit-orange-dark), var(--rabbit-orange));
    box-shadow: 0 3px 8px rgba(255, 126, 0, 0.3), inset 0 2px 4px rgba(0,0,0,0.15);
}
.ptt-button.active { animation: ptt-pulse 1.2s infinite ease-in-out; } /* Faster pulse */
@keyframes ptt-pulse {
    0% { box-shadow: 0 3px 8px rgba(255, 126, 0, 0.3), inset 0 2px 4px rgba(0,0,0,0.15); }
    50% { box-shadow: 0 6px 18px rgba(255, 126, 0, 0.45), inset 0 2px 4px rgba(0,0,0,0.15); }
    100% { box-shadow: 0 3px 8px rgba(255, 126, 0, 0.3), inset 0 2px 4px rgba(0,0,0,0.15); }
}
.ptt-button:disabled { background: var(--medium-gray); cursor: not-allowed; box-shadow: none; transform: none; animation: none; opacity: 0.6; }
.ptt-button:disabled:active { transform: none; }
.ptt-button:disabled::before { display: none; }

.scroll-controls { display: flex; gap: 25px; }
.scroll-button {
    width: 42px; height: 42px; border-radius: 50%;
    background: linear-gradient(145deg, var(--medium-gray), var(--light-gray));
    border: none; display: flex; justify-content: center; align-items: center;
    cursor: pointer; color: var(--dark-gray);
    transition: all 0.2s ease;
    user-select: none; -webkit-user-select: none; touch-action: manipulation;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.scroll-button:hover {
    background: linear-gradient(145deg, var(--light-gray), var(--medium-gray));
    box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    transform: translateY(-1px);
}
.scroll-button:active { transform: translateY(0px) scale(0.96); box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }

/* --- Animation Keyframes --- */
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes fadeInScale {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-15px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeInUpList { /* Staggered list items */
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}
.alarms-list li, .gallery-item { /* Apply base for staggering */
    opacity: 0; animation: fadeInUpList 0.5s var(--transition-timing) forwards;
}
/* Example staggering (can be done with JS for more items) */
.alarms-list li:nth-child(1), .gallery-item:nth-child(1) { animation-delay: 0.1s; }
.alarms-list li:nth-child(2), .gallery-item:nth-child(2) { animation-delay: 0.15s; }
.alarms-list li:nth-child(3), .gallery-item:nth-child(3) { animation-delay: 0.2s; }
.alarms-list li:nth-child(4), .gallery-item:nth-child(4) { animation-delay: 0.25s; }
/* etc. */

@keyframes shake {
    10%, 90% { transform: translateX(-1px); }
    20%, 80% { transform: translateX(2px); }
    30%, 50%, 70% { transform: translateX(-3px); }
    40%, 60% { transform: translateX(3px); }
}

/* --- Responsive Adjustments --- */
@media (max-width: 400px) {
    body { padding: 10px; }
    .device-container { max-width: 100%; }
    .rabbit-device { border-radius: 24px; padding: 15px; gap: 15px; }
    .main-display { border-radius: 16px; }
    .screen { padding: 20px; } /* Restore default padding */
    .home-screen { padding-top: 40px; } /* Adjust home padding */
    .status-bar { top: 8px; left: 10px; right: 10px; font-size: 10px; padding: 3px 6px; }
    .vision-screen, .look-at-this-screen { padding: 0; } /* Keep no padding for camera */
    .screen h2 { font-size: 20px; margin-bottom: 15px; }
    .vision-screen h2, .look-at-this-screen h2 { font-size: 14px; padding: 5px 10px; top: 10px; } /* Adjust title on camera */
    .greeting { font-size: 24px; }
    .instruction { font-size: 16px; }
    .timer-display { font-size: 30px; }
    .album-art { width: 120px; height: 120px; font-size: 45px; }
    .track-title { font-size: 16px; }
    .artist-name { font-size: 14px; }
    /* camera-container already full screen */
    .response-text { font-size: 14px; line-height: 1.6; }
    .response-text th, .response-text td { padding: 10px; }
    .gallery-container { grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; }
    .gallery-item img { height: 80px; }
    .glass-overlay { padding: 8px 15px; border-radius: 12px; }
    .capture-btn, .look-capture-btn { font-size: 15px; padding: 9px 18px; }
    .vision-capture-overlay { bottom: 65px; } /* Adjust overlay positions for smaller screens */
    .look-capture-overlay { bottom: 65px; }
    .look-status-overlay { bottom: 115px; font-size: 13px; min-width: 180px; }
    .ptt-button { width: 60px; height: 60px; font-size: 26px; }
    .scroll-button { width: 40px; height: 40px; }
    .scroll-controls { gap: 20px; }
    .back-button { padding: 9px 18px; }
    .response-screen .back-button, .error-screen .back-button, .notes-screen .back-button,
    .gallery-screen .back-button { bottom: 15px; }
    .vision-screen .back-button, .look-at-this-screen .back-button { bottom: 15px; } /* Adjust camera back button */
}
